<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      font-family: Inter, sans-serif;
      padding: 12px;
      margin: 0;
      font-size: 11px;
      height: calc(100vh - 24px);
      display: flex;
      flex-direction: column;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
    }

    .form-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-weight: 500;
      color: #7f7f7f;
      font-size: 11px;
    }

    select, input[type="text"] {
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #E5E5E5;
      font-size: 11px;
      font-family: Inter, sans-serif;
    }

    select {
  /* Hide default arrow */
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  
  /* Add custom smaller arrow with right padding */
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 6"><path fill="none" stroke="%23666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M2 2l3 3 3-3"/></svg>');
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 8px; /* Smaller arrow */
  padding-right: 20px; /* Extra padding on the right */
}

    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: #18A0FB;
      box-shadow: 0 0 0 2px rgba(24, 160, 251, 0.1);
    }

    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .radio-option input[type="radio"], .radio-option input[type="checkbox"] {
      margin: 0;
    }

    .radio-option label {
      font-weight: normal;
      margin: 0;
      cursor: pointer;
      font-size: 12px;
    }

    button {
      border-radius: 4px;
      padding: 8px 16px;
      background: #18A0FB;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      font-family: Inter, sans-serif;
      width: 100%;
      margin-top: auto;
    }

    button:hover {
      background: #0D8EE9;
    }

    .hidden {
      display: none;
    }

    .info-text {
      font-size: 11px;
      color: #666;
      line-height: 1.4;
      margin-top: 2px;
    }

    .expandable-panel {
      /* border: 1px solid #E5E5E5; */
      border-radius: 4px;
      overflow: hidden;
    }

    .clickable-text {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: start;
      font-size: 11px;
      font-weight: 500;
      color: #7f7f7f;
      user-select: none;
      gap: 6px;
      padding: 4px 0;
      transition: color 0.2s ease;
    }

    .clickable-text:hover {
      color: #18A0FB;
    }

    .expandable-content {
      /* padding: 12px; */
      display: none;
    }

    .expandable-content.expanded {
      display: block;
    }

    .expandable-arrow {
      width: 12px;
      height: 12px;
      transition: transform 0.2s ease;
    }

    .expandable-arrow.expanded {
      transform: rotate(90deg);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="form-content">
      <div class="form-group">
        <label for="collection">Save to</label>
        <select id="collection">
          <option value="new">Create new collection</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Variable name</label>
        <div class="info-text">
As default, the plugin analyses the selected color fill and tries to best guess the closest color name.<p> To apply a custom name, select a text layer that is grouped with the layer that contains the color fill. The plugin will apply that text to the variable.</p>     </div>
        
        <div class="expandable-panel">
          <div class="clickable-text" onclick="toggleExpandable()">
            <svg class="expandable-arrow" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4.5 3L7.5 6L4.5 9" stroke="#666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Other naming options</span>
          </div>
          <div class="expandable-content" id="other-options">
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="auto-name" name="naming-mode" value="auto" checked>
                <label for="auto-name">Best match</label>
              </div>
              <div class="info-text" id="auto-info" style="margin-left: 18px; margin-top: 2px;">
                Analyzes RGB values to find the closest CSS color name (e.g., red-85, blue-72)
              </div>
              <div class="radio-option">
                <input type="radio" id="manual-name" name="naming-mode" value="manual">
                <label for="manual-name">Custom</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="form-group hidden" id="custom-name-row">
        <input type="text" id="custom-name" placeholder="Enter variable name...">
        <div class="radio-option" style="margin-top: 6px;">
          <input type="checkbox" id="append-color" checked>
          <label for="append-color">Append color match (e.g., MyColor-red-85)</label>
        </div>
      </div>
    </div>
    <button id="create">Create Variable</button>
  </div>
  <script>
    // Initialize by requesting collections
    parent.postMessage({ pluginMessage: { type: 'get-collections' } }, '*');

    // Handle collections data
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg.type === 'update-collections') {
        updateCollectionsDropdown(msg.collections, msg.defaultCollectionId);
      } else if (msg.type === 'collection-created') {
        // Add the newly created collection to the dropdown and select it
        addNewCollectionToDropdown(msg.collection);
      }
    };

    function updateCollectionsDropdown(collections, defaultCollectionId = null) {
      const select = document.getElementById('collection');
      select.innerHTML = '';
      
      let hasDefault = false;
      
      // Add existing collections first
      collections.forEach(collection => {
        const option = document.createElement('option');
        option.value = collection.id;
        option.textContent = collection.name;
        
        // Select the default collection if specified
        if (defaultCollectionId === collection.id) {
          option.selected = true;
          hasDefault = true;
        }
        
        select.appendChild(option);
      });
      
      // Add "Create new collection" option at the end
      const newOption = document.createElement('option');
      newOption.value = 'new';
      newOption.textContent = 'Create new collection';
      
      // Only select "Create new collection" if no default was found and no collections exist
      if (!hasDefault && collections.length === 0) {
        newOption.selected = true;
      }
      
      select.appendChild(newOption);
    }

    function addNewCollectionToDropdown(newCollection) {
      const select = document.getElementById('collection');
      
      // Remove the "Create new collection" option temporarily
      const createNewOption = select.querySelector('option[value="new"]');
      if (createNewOption) {
        createNewOption.remove();
      }
      
      // Add the new collection
      const option = document.createElement('option');
      option.value = newCollection.id;
      option.textContent = newCollection.name;
      option.selected = true; // Select the newly created collection
      select.appendChild(option);
      
      // Re-add "Create new collection" option at the end
      const newOption = document.createElement('option');
      newOption.value = 'new';
      newOption.textContent = 'Create new collection';
      select.appendChild(newOption);
    }

    // Handle naming mode toggle
    document.querySelectorAll('input[name="naming-mode"]').forEach(radio => {
      radio.addEventListener('change', () => {
        const customNameRow = document.getElementById('custom-name-row');
        const customNameInput = document.getElementById('custom-name');
        const autoInfo = document.getElementById('auto-info');
        
        if (radio.value === 'manual') {
          customNameRow.classList.remove('hidden');
          autoInfo.classList.add('hidden');
          customNameInput.focus();
        } else {
          customNameRow.classList.add('hidden');
          autoInfo.classList.remove('hidden');
        }
      });
    });

    function toggleExpandable() {
      const content = document.getElementById('other-options');
      const arrow = document.querySelector('.expandable-arrow');
      
      content.classList.toggle('expanded');
      arrow.classList.toggle('expanded');
    }
    
    document.getElementById('create').onclick = () => {
      const collectionId = document.getElementById('collection').value;
      const namingMode = document.querySelector('input[name="naming-mode"]:checked').value;
      const customName = document.getElementById('custom-name').value;
      const appendColor = document.getElementById('append-color').checked;
      
      parent.postMessage({
        pluginMessage: {
          type: 'create-variable',
          collectionId,
          namingMode,
          customName,
          appendColor
        }
      }, '*');
    };
  </script>
</body>

</html>