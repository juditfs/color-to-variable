<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      font-family: Inter, sans-serif;
      padding: 12px;
      margin: 0;
      font-size: 12px;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-weight: 500;
      color: #333;
      font-size: 12px;
    }

    select, input[type="text"] {
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #E5E5E5;
      font-size: 12px;
      font-family: Inter, sans-serif;
    }

    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: #18A0FB;
      box-shadow: 0 0 0 2px rgba(24, 160, 251, 0.1);
    }

    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .radio-option input[type="radio"] {
      margin: 0;
    }

    .radio-option label {
      font-weight: normal;
      margin: 0;
      cursor: pointer;
      font-size: 12px;
    }

    button {
      border-radius: 4px;
      padding: 8px 16px;
      background: #18A0FB;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      font-family: Inter, sans-serif;
      width: 100%;
    }

    button:hover {
      background: #0D8EE9;
    }

    .hidden {
      display: none;
    }

    .info-text {
      font-size: 11px;
      color: #666;
      line-height: 1.4;
      margin-top: 2px;
    }

  </style>
</head>

<body>
  <div class="container">
    <div class="form-group">
      <label for="collection">Collection</label>
      <select id="collection">
        <option value="new">Create new collection</option>
      </select>
    </div>
    
    <div class="form-group">
      <label>Variable name</label>
      <div class="info-text">
        If a text layer grouped with the color layer is selected, the variable will use the text as the variable name. Otherwise, it will fall back to one of these options:
      </div>
      <div class="radio-group">
        <div class="radio-option">
          <input type="radio" id="auto-name" name="naming-mode" value="auto" checked>
          <label for="auto-name">Best match</label>
        </div>
        <div class="info-text" id="auto-info" style="margin-left: 18px; margin-top: 2px;">
          Analyzes RGB values to find the closest CSS color name (e.g., red-85, blue-72)
        </div>
        <div class="radio-option">
          <input type="radio" id="manual-name" name="naming-mode" value="manual">
          <label for="manual-name">Custom</label>
        </div>
      </div>
    </div>
    
    <div class="form-group hidden" id="custom-name-row">
      <input type="text" id="custom-name" placeholder="Enter variable name...">
    </div>
    
    <button id="create">Create Variable</button>
  </div>
  <script>
    // Initialize by requesting collections
    parent.postMessage({ pluginMessage: { type: 'get-collections' } }, '*');

    // Handle collections data
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg.type === 'update-collections') {
        updateCollectionsDropdown(msg.collections);
      } else if (msg.type === 'collection-created') {
        // Add the newly created collection to the dropdown and select it
        addNewCollectionToDropdown(msg.collection);
      }
    };

    function updateCollectionsDropdown(collections) {
      const select = document.getElementById('collection');
      select.innerHTML = '';
      
      // Add existing collections first
      collections.forEach(collection => {
        const option = document.createElement('option');
        option.value = collection.id;
        option.textContent = collection.name;
        select.appendChild(option);
      });
      
      // Add "Create new collection" option at the end
      const newOption = document.createElement('option');
      newOption.value = 'new';
      newOption.textContent = 'Create new collection';
      select.appendChild(newOption);
    }

    function addNewCollectionToDropdown(newCollection) {
      const select = document.getElementById('collection');
      
      // Remove the "Create new collection" option temporarily
      const createNewOption = select.querySelector('option[value="new"]');
      if (createNewOption) {
        createNewOption.remove();
      }
      
      // Add the new collection
      const option = document.createElement('option');
      option.value = newCollection.id;
      option.textContent = newCollection.name;
      option.selected = true; // Select the newly created collection
      select.appendChild(option);
      
      // Re-add "Create new collection" option at the end
      const newOption = document.createElement('option');
      newOption.value = 'new';
      newOption.textContent = 'Create new collection';
      select.appendChild(newOption);
    }

    // Handle naming mode toggle
    document.querySelectorAll('input[name="naming-mode"]').forEach(radio => {
      radio.addEventListener('change', () => {
        const customNameRow = document.getElementById('custom-name-row');
        const customNameInput = document.getElementById('custom-name');
        const autoInfo = document.getElementById('auto-info');
        
        if (radio.value === 'manual') {
          customNameRow.classList.remove('hidden');
          autoInfo.classList.add('hidden');
          customNameInput.focus();
        } else {
          customNameRow.classList.add('hidden');
          autoInfo.classList.remove('hidden');
        }
      });
    });

    document.getElementById('create').onclick = () => {
      const collectionId = document.getElementById('collection').value;
      const namingMode = document.querySelector('input[name="naming-mode"]:checked').value;
      const customName = document.getElementById('custom-name').value;
      
      parent.postMessage({
        pluginMessage: {
          type: 'create-variable',
          collectionId,
          namingMode,
          customName
        }
      }, '*');
    };
  </script>
</body>

</html>
